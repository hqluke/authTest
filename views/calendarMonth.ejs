<!DOCTYPE html>
<html>
    <head>
        <title>Calendar - <%= month %>/<%= year %></title>
        <link rel="stylesheet" href="/calendarMonth.css" />
    </head>
    <body>
        <div class="calendar-container">
            <a href="/calendar?year=<%= year %>" class="back-link">â† Back to Year View</a>
            <h1><%= new Date(year, month - 1).toLocaleString('default', { month: 'long' }) %> <%= year %></h1>
            
            <div class="calendar-grid">
                <div class="day-header">Sun</div>
                <div class="day-header">Mon</div>
                <div class="day-header">Tue</div>
                <div class="day-header">Wed</div>
                <div class="day-header">Thu</div>
                <div class="day-header">Fri</div>
                <div class="day-header">Sat</div>
                
                <% 
                const workoutMap = {};
                breakdown.forEach(row => {
                    workoutMap[row.date.getDate()] = {
                        has_upper: row.has_upper,
                        has_lower: row.has_lower,
                        has_run: row.has_run
                    };
                });
                
                const firstDay = new Date(year, month - 1, 1).getDay();
                const daysInMonth = new Date(year, month, 0).getDate();
                
                let monthUpper = 0;
                let monthLower = 0;
                let monthRuns = 0;
                
                for (let i = 0; i < firstDay; i++) { 
                %>
                    <div class="day-cell empty-day"></div>
                <% } %>
                
                <% 
                for (let day = 1; day <= daysInMonth; day++) {
                    const workout = workoutMap[day];
                    if (workout) {
                        if (workout.has_upper) monthUpper++;
                        if (workout.has_lower) monthLower++;
                        if (workout.has_run) monthRuns++;
                %>
                    <a href="/calendar?year=<%= year %>&month=<%= month %>&day=<%= day %>" style="text-decoration: none; color: inherit;">
                        <div class="day-cell workout-day">
                            <div class="day-number"><%= day %></div>
                            <div class="workout-indicators">
                                <% if (workout.has_upper) { %><span title="Upper">ğŸ’ª</span><% } %>
                                <% if (workout.has_lower) { %><span title="Lower">ğŸ¦µ</span><% } %>
                                <% if (workout.has_run) { %><span title="Run">ğŸƒ</span><% } %>
                            </div>
                        </div>
                    </a>
                <% } else { %>
                    <a href="/exercise?year=<%= year %>&month=<%= month %>&day=<%= day %>" style="text-decoration: none; color: inherit;">
                        <div class="day-cell empty-workout-day">
                            <%= day %>
                        </div>
                    </a>
                <% } } %>
            </div>
            
            <div class="month-summary">
                <h3>Month Summary</h3>
                <p>ğŸ’ª Upper Body: <strong><%= monthUpper %></strong> days</p>
                <p>ğŸ¦µ Lower Body: <strong><%= monthLower %></strong> days</p>
                <p>ğŸƒ Runs: <strong><%= monthRuns %></strong> days</p>
            </div>
        </div>
    </body>
</html>
