<!DOCTYPE html>
<html>
    <head>
        <title>Calendar - <%= month %>/<%= year %></title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/calendarMonth.css" />
    </head>
    <body>
        <div class="calendar-container">
            <a href="/calendar?year=<%= year %>" class="back-link">‚Üê Back to Year View</a>
            <h1><%= new Date(year, month - 1).toLocaleString('default', { month: 'long' }) %> <%= year %></h1>
            
            <div class="calendar-grid">
                <div class="day-header">Sun</div>
                <div class="day-header">Mon</div>
                <div class="day-header">Tue</div>
                <div class="day-header">Wed</div>
                <div class="day-header">Thu</div>
                <div class="day-header">Fri</div>
                <div class="day-header">Sat</div>
                
                <% 
                const workoutMap = {};
                breakdown.forEach(row => {
                    workoutMap[row.date.getDate()] = {
                        has_upper: row.has_upper,
                        has_lower: row.has_lower,
                        has_run: row.has_run
                    };
                });
                
                const firstDay = new Date(year, month - 1, 1).getDay();
                const daysInMonth = new Date(year, month, 0).getDate();
                
                let monthUpper = 0;
                let monthLower = 0;
                let monthRuns = 0;
                let totalDays = 0;
                
                for (let i = 0; i < firstDay; i++) { 
                %>
                    <div class="day-cell empty-day"></div>
                <% } %>
                
                <% 
                for (let day = 1; day <= daysInMonth; day++) {
                    const workout = workoutMap[day];
                    if (workout) {
                        totalDays++;
                        if (workout.has_upper) monthUpper++;
                        if (workout.has_lower) monthLower++;
                        if (workout.has_run) monthRuns++;
                %>
                    <a href="/calendar?year=<%= year %>&month=<%= month %>&day=<%= day %>" style="text-decoration: none; color: inherit;">
                        <div class="day-cell workout-day">
                            <div class="day-number"><%= day %></div>
                            <div class="workout-indicators">
                                <% if (workout.has_upper) { %><span title="Upper">üí™</span><% } %>
                                <% if (workout.has_lower) { %><span title="Lower">ü¶µ</span><% } %>
                                <% if (workout.has_run) { %><span title="Run">üèÉ</span><% } %>
                            </div>
                        </div>
                    </a>
                <% } else { %>
                    <a href="/exercise?year=<%= year %>&month=<%= month %>&day=<%= day %>" style="text-decoration: none; color: inherit;">
                        <div class="day-cell empty-workout-day">
                            <%= day %>
                        </div>
                    </a>
                <% } } %>
            </div>
            
            <div class="total-stats">
                <h2>Month Summary</h2>
                <div class="month-summary-total">
                    <div class="total-days-large"><%= totalDays %> workout days</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">üí™ Upper Body</div>
                        <div class="stat-value"><%= monthUpper %></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ü¶µ Lower Body</div>
                        <div class="stat-value"><%= monthLower %></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üèÉ Runs</div>
                        <div class="stat-value"><%= monthRuns %></div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
