<!DOCTYPE html>
<html>
    <head>
        <title>Edit Exercise - <%= exerciseData[0].name %></title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/calendarEdit.css" />
    </head>
    <body>
        <div class="container">
            <a href="/calendar?year=<%= year %>&month=<%= month %>&day=<%= day %>" class="back-link">
                ‚Üê Back to Day View
            </a>

            <h1>Edit <%= exerciseData[0].name %></h1>
            <p style="text-align: center; color: #999;"><%= month %>/<%= day %>/<%= year %></p>

            <form action="/calendar/edit" method="POST" class="form-container" id="editForm">
                <input type="hidden" name="year" value="<%= year %>">
                <input type="hidden" name="month" value="<%= month %>">
                <input type="hidden" name="day" value="<%= day %>">

                <% exerciseData.forEach((set, index) => { %>
                    <div class="set-row">
                        <label>Set <%= index + 1 %></label>
                        
                        <input type="hidden" name="id-<%= set.id %>" value="<%= set.id %>">
                        <input type="hidden" name="sets-<%= set.id %>" value="<%= set.sets %>">
                        
                        <div class="form-group">
                            <label>Reps</label>
                            <select name="reps-<%= set.id %>">
                                <% reps.forEach(rep => { %>
                                    <option value="<%= rep.reps %>" <%= set.reps == rep.reps ? 'selected' : '' %>>
                                        <%= rep.reps %>
                                    </option>
                                <% }) %>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Weight</label>
                            <select name="weight-<%= set.id %>">
                                <% weights.forEach(weight => { %>
                                    <option value="<%= weight.weight %>" <%= set.weight == weight.weight ? 'selected' : '' %>>
                                        <%= weight.weight %>
                                    </option>
                                <% }) %>
                            </select>
                        </div>
                        
                        <button 
                            type="button" 
                            class="btn-delete delete-btn" 
                            data-set-id="<%= set.id %>">
                            Delete
                        </button>
                    </div>
                <% }) %>

                <div class="button-group">
                    <button type="submit" class="btn-save">Save Changes</button>
                    <button type="button" class="btn-delete-all" id="deleteAllBtn">Delete All</button>
                    <a href="/calendar?year=<%= year %>&month=<%= month %>&day=<%= day %>">
                        <button type="button" class="btn-cancel">Cancel</button>
                    </a>
                </div>
            </form>
        </div>

        <script>
            const year = <%= year %>;
            const month = <%= month %>;
            const day = <%= day %>;
            
            document.addEventListener('DOMContentLoaded', function() {
                // Delete individual set with mobile support
                document.querySelectorAll('.delete-btn').forEach(button => {
                    // Click event for desktop
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const id = this.getAttribute('data-set-id');
                        deleteSet(id);
                    });
                    
                    // Touch event for mobile
                    button.addEventListener('touchend', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        const id = this.getAttribute('data-set-id');
                        deleteSet(id);
                    });
                });
                
                // Delete all sets
                document.getElementById('deleteAllBtn').addEventListener('click', function(e) {
                    e.preventDefault();
                    deleteAllSets();
                });
            });
            
            function deleteSet(id) {
                if (confirm('Are you sure you want to delete this set?')) {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/calendar/delete';
                    
                    const idInput = document.createElement('input');
                    idInput.type = 'hidden';
                    idInput.name = 'id';
                    idInput.value = id;
                    
                    const yearInput = document.createElement('input');
                    yearInput.type = 'hidden';
                    yearInput.name = 'year';
                    yearInput.value = year;
                    
                    const monthInput = document.createElement('input');
                    monthInput.type = 'hidden';
                    monthInput.name = 'month';
                    monthInput.value = month;
                    
                    const dayInput = document.createElement('input');
                    dayInput.type = 'hidden';
                    dayInput.name = 'day';
                    dayInput.value = day;
                    
                    form.appendChild(idInput);
                    form.appendChild(yearInput);
                    form.appendChild(monthInput);
                    form.appendChild(dayInput);
                    
                    document.body.appendChild(form);
                    form.submit();
                }
            }
            
            function deleteAllSets() {
                const deleteButtons = document.querySelectorAll('.delete-btn');
                
                const setIds = [];
                deleteButtons.forEach(btn => {
                    const id = btn.getAttribute('data-set-id');
                    setIds.push(id);
                });
                
                
                const numSets = setIds.length;
                if (confirm(`Are you sure you want to delete all ${numSets} sets? This cannot be undone!`)) {
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = '/calendar/delete-all-sets';
                    
                    // Add each ID as ids[]
                    setIds.forEach(id => {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = 'ids[]';
                        input.value = id;
                        form.appendChild(input);
                    });
                    
                    const yearInput = document.createElement('input');
                    yearInput.type = 'hidden';
                    yearInput.name = 'year';
                    yearInput.value = year;
                    form.appendChild(yearInput);
                    
                    const monthInput = document.createElement('input');
                    monthInput.type = 'hidden';
                    monthInput.name = 'month';
                    monthInput.value = month;
                    form.appendChild(monthInput);
                    
                    const dayInput = document.createElement('input');
                    dayInput.type = 'hidden';
                    dayInput.name = 'day';
                    dayInput.value = day;
                    form.appendChild(dayInput);
                    
                    document.body.appendChild(form);
                    form.submit();
                }
            }
        </script>
    </body>
</html>
