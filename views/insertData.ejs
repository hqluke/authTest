<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Insert Data</title>
    </head>
    <body>
        <h1><%= exercise.name %></h1>
        <form action="/exercise/insertData" method="POST">
            <input type="hidden" name="exerciseId" value="<%= exercise.id %>" />
            <input
                type="hidden"
                name="isUpperBody"
                value="<%= exercise.isupperbody %>"
            />
            <div class="isets">
                <label for="select-sets">Sets</label>
                <select name="sets" id="select-sets">
                    <%sets.forEach(set => {%>
                    <option value="<%=set.sets%>"><%=set.sets%></option>
                    <%})%>
                </select>
            </div>
            <div class="iweightsandreps">
                <div class="iweight">
                    <label for="select-weight">Weight</label>
                    <select name="weight" id="select-weight">
                        <%weights.forEach(weight => {%>
                        <option value="<%=weight.weight%>">
                            <%=weight.weight%>
                        </option>
                        <%})%>
                    </select>
                </div>
                <div class="ireps">
                    <label for="select-reps">Reps</label>
                    <select name="reps" id="select-reps">
                        <%reps.forEach(rep => {%>
                        <option value="<%=rep.reps%>"><%=rep.reps%></option>
                        <%})%>
                    </select>
                </div>
            </div>
            <button type="submit">Insert Data</button>
        </form>

        <script>

            //converts the reps data to json so it can be used in the js
                const repsData = <%- JSON.stringify(reps) %>;
                // console.log(repsData);

                const weightData = <%- JSON.stringify(weights) %>;
                // console.log(weightData);

            const lastData = <%- JSON.stringify(lastData) %>;
            console.log(lastData);


            let select = document.getElementById("select-sets");

            document.getElementById("select-sets").addEventListener("change", () => {
                displayNumSets();
                displayNumWeight();
            });

            const repDiv = document.querySelector(".ireps");
            const weightDiv = document.querySelector(".iweight");

            window.addEventListener("load", () => {

                if (lastData.sets) {
                    select.value = lastData.sets;
                    displayNumSets();
                    displayNumWeight();
                }
            });

            function displayNumWeight(){
                console.log("calling num weight");
                while(weightDiv.firstChild){
                    weightDiv.removeChild(weightDiv.lastChild);
                }

                let select = document.getElementById("select-sets");
                selectedSets = select.value;

                for (let i = 0; i <= selectedSets-1; i++) {
                    let num = i + 1;
                    const weightLabel = document.createElement("label");
                    weightLabel.setAttribute("for", "select-weight-" + num);
                    weightLabel.innerText = "Weight " + num;
                    weightDiv.appendChild(weightLabel);

                    const weightSelect = document.createElement("select");
                    weightSelect.setAttribute("name", "weight-" + num);
                    weightSelect.setAttribute("id", "select-weight-" + num);

                        weightData.forEach(weight => {
                            const option = document.createElement("option");
                            option.setAttribute("value", weight.weight);
                            option.innerText = weight.weight;
                            weightSelect.appendChild(option);
                        });

                    if (lastData.weight) {
                        weightSelect.value = lastData.weight;
                    }
                    else{
                        weightSelect.value = weightData[0].weight;
                    }
                    weightDiv.appendChild(weightSelect);
                }


            }

            function displayNumSets(num){
                console.log("calling num sets");
                while(repDiv.firstChild){
                repDiv.removeChild(repDiv.lastChild);
                }


                let select = document.getElementById("select-sets");
                let selectedSets = select.value;

                for (let i = 0; i <= selectedSets-1; i++) {
                    let num = i + 1;
                    const repsLabel = document.createElement("label");
                    repsLabel.setAttribute("for", "select-reps-" + num);
                    repsLabel.innerText = "Reps " + num;
                    repDiv.appendChild(repsLabel);

                    const repsSelect = document.createElement("select");
                    repsSelect.setAttribute("name", "reps-" + num);
                    repsSelect.setAttribute("id", "select-reps-" + num);

                        repsData.forEach(rep => {
                            const option = document.createElement("option");
                            option.setAttribute("value", rep.reps);
                            option.innerText = rep.reps;
                            repsSelect.appendChild(option);
                        });

                    if (lastData.reps) {
                        repsSelect.value = lastData.reps;
                    }
                    else{
                        repsSelect.value = repsData[0].reps;
                    }
                    repDiv.appendChild(repsSelect);
                }
            }
        </script>
    </body>
</html>
