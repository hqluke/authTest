<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Insert Data</title>
    </head>
    <body>
        <h1><%= exercise.name %></h1>
        <form action="/exercise/insertData" method="POST">
            <input type="hidden" name="exerciseId" value="<%= exercise.id %>" />
            <input
                type="hidden"
                name="isUpperBody"
                value="<%= exercise.isupperbody %>"
            />
            <label for="select-weight">Weight</label>
            <select name="weight" id="select-weight">
                <%weights.forEach(weight => {%>
                <option value="<%=weight.weight%>"><%=weight.weight%></option>
                <%})%>
            </select>
            <div class="isets">
                <input
                    type="hidden"
                    name="totalSets"
                    id="totalSets"
                    value="0"
                />
                <label for="select-sets">Sets</label>
                <select name="sets" id="select-sets">
                    <%sets.forEach(set => {%>
                    <option value="<%=set.sets%>"><%=set.sets%></option>
                    <%})%>
                </select>
            </div>
            <div class="ireps">
                <label for="select-reps">Reps</label>
                <select name="reps" id="select-reps">
                    <%reps.forEach(rep => {%>
                    <option value="<%=rep.reps%>"><%=rep.reps%></option>
                    <%})%>
                </select>
            </div>
            <button type="submit">Insert Data</button>
        </form>
    </body>
</html>

<script>

    //converts the reps data to json so it can be used in the js
        const repsData = <%- JSON.stringify(reps) %>;
        console.log(repsData);


    document.getElementById("select-sets").addEventListener("change", displayNumSets);

    const repDiv = document.querySelector(".ireps");
    const hiddenSets = document.getElementById("totalSets");

    function displayNumSets(){
        while(repDiv.firstChild){
        repDiv.removeChild(repDiv.lastChild);
        }

        const select = document.getElementById("select-sets");
        selectedSets = select.value;

        hiddenSets.value = selectedSets;

        for (let i = 1; i <= selectedSets; i++) {
            const repsLabel = document.createElement("label");
            repsLabel.setAttribute("for", "select-reps-" + i);
            repsLabel.innerText = "Reps " + i;
            repDiv.appendChild(repsLabel);
            const repsSelect = document.createElement("select");
            repsSelect.setAttribute("name", "reps-" + i);
            repsSelect.setAttribute("id", "select-reps-" + i);
                repsData.forEach(rep => {
                    const option = document.createElement("option");
                    option.setAttribute("value", rep.reps);
                    option.innerText = rep.reps;
                    repsSelect.appendChild(option);
                });
            repDiv.appendChild(repsSelect);
        }
    }
</script>
